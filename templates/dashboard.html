<!DOCTYPE html>
<html>
<head>
    <title>Secure Vault Dashboard</title>
    <style>
        /* Professional Dark Theme */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0d1117; color: #c9d1d9; padding: 40px; margin: 0; }
        .container { max-width: 1000px; margin: auto; }
        
        /* Header & Badges */
        .header { border-bottom: 2px solid #30363d; padding-bottom: 20px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        h1 { color: #58a6ff; margin: 0; }
        .role-badge { padding: 5px 12px; border-radius: 20px; font-size: 13px; font-weight: bold; background: #238636; color: white; text-transform: uppercase; }
        
        /* Object 1: Upload Card */
        .card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        h3 { margin-top: 0; color: #f0f6fc; border-left: 4px solid #238636; padding-left: 10px; }
        
        /* Form & Buttons */
        input[type="file"] { background: #0d1117; border: 1px solid #30363d; padding: 10px; border-radius: 6px; color: #c9d1d9; width: 70%; }
        .btn-main { background: #238636; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-main:hover { background: #2ea043; }
        
        /* Object 2: Evidence Table */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; padding: 15px; background: #21262d; color: #8b949e; border-bottom: 2px solid #30363d; }
        td { padding: 15px; border-bottom: 1px solid #30363d; }
        
        /* Object 3: Actions */
        .status-enc { color: #3fb950; font-weight: bold; font-size: 12px; }
        .btn-delete { color: #f85149; text-decoration: none; font-size: 13px; font-weight: bold; border: 1px solid #f85149; padding: 4px 8px; border-radius: 4px; }
        .btn-delete:hover { background: rgba(248, 81, 73, 0.1); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Evidence Vault</h1>
            <div>
                <span style="margin-right: 15px;">Investigator: <strong>{{ session.get('username', 'User') }}</strong></span>
                <span class="role-badge">{{ user_role }}</span>

                <a href="/logout" style="color: #f85149; text-decoration: none; font-weight: bold; border: 1px solid #f85149; padding: 5px 12px; border-radius: 6px; font-size: 13px;">Logout / Switch Account</a>
            </div>
        </div>

        {% if user_role in ['Lead Analyst', 'Investigator'] %}
        <div class="card">
            <h3>Secure File Upload</h3>
            <p style="font-size: 14px; color: #8b949e;">Files are encrypted using AES-256 and signed with RSA before storage.</p>
            <form action="/upload" method="post" enctype="multipart/form-data">
                <input type="file" name="evidence_file" required>
                <button type="submit" class="btn-main">Encrypt & Sign</button>
            </form>
        </div>
        {% endif %}

        <div class="card">
            <h3>Chain of Custody (Encrypted Log)</h3>
            <table>
                <thead>
                    <tr>
                        <th>File Name</th>
                        <th>Uploader</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in evidence %}
                    <tr>
                        <td>{{ item.filename }}</td>
                        <td>{{ item.uploader }}</td>
                        <td><span class="status-enc">‚óè AES-256 SECURED</span></td>
                        <td>
                            {% if user_role in ['Lead Analyst', 'Investigator'] %}
                            <a href="/download/{{ item.id }}" style="color: #58a6ff; margin-left: 10px; text-decoration: none; font-weight: bold;">Download</a>
                            {% endif %}

                            {% if user_role == 'Lead Analyst' %}
                                <a href="/delete/{{ item.id }}" class="btn-delete" style="margin-left: 10px;">Delete</a>
                            {% endif %}
                            
                            {% if user_role == 'Legal Auditor' %}
                                <button onclick="alert('Digital Signature: {{ item.signature }}\n\nVerification Status: VALID (SHA-256 Match)')" 
                                style="background: #1f6feb; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; margin-left: 10px;">
                                Verify Integrity
                                </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>